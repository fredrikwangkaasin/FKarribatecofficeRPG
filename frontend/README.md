# Sample Frontend

React + TypeScript + Vite frontend for the multi-tenant sample application.

## Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Setup SSL Certificates (Required for HTTPS Development)

The frontend development server uses HTTPS with trusted certificates generated by mkcert.

```bash
# Run the certificate setup script
npm run setup:certs

# Or run directly:
# Windows
.\setup-certs.ps1

# Mac/Linux
./setup-certs.sh
```

**First time?** Make sure mkcert is installed:
- **Windows**: `choco install mkcert` (requires Administrator PowerShell)
- **Mac**: `brew install mkcert`
- **Linux**: See [mkcert installation guide](https://github.com/FiloSottile/mkcert#installation)

After installing mkcert, run `mkcert -install` to install the local CA.

### 3. Start Development Server

```bash
npm run dev
```

The app will automatically open at: **https://admin.localtest.me:7300/sample/**

## Development

### Available Scripts

- `npm run setup:certs` - Generate SSL certificates using mkcert
- `npm run dev` - Start development server with HTTPS
- `npm run build` - Build for production
- `npm run preview` - Preview production build

### Project Structure

```
frontend/
├── .certs/                      # SSL certificates (auto-generated)
├── src/
│   ├── App.tsx                 # Main app with auth provider
│   ├── main.tsx                # Entry point
│   ├── index.css               # Global styles
│   └── components/
│       ├── HomePage.tsx        # Protected home page
│       └── LoginPage.tsx       # Login page
├── setup-certs.ps1             # Windows certificate setup
├── setup-certs.sh              # Mac/Linux certificate setup
├── vite.config.ts              # Vite configuration
├── package.json                # Dependencies and scripts
└── tsconfig.json               # TypeScript configuration
```

### HTTPS Configuration

The development server is configured for HTTPS in `vite.config.ts`:

```typescript
server: {
  port: 7300,
  https: {
    key: './.certs/_wildcard.localtest.me-key.pem',
    cert: './.certs/_wildcard.localtest.me.pem'
  },
  // ...
}
```

### API Proxy

All API requests to `/sample/api` are proxied to the backend at `http://localhost:7301`:

```typescript
proxy: {
  '/sample/api': {
    target: 'http://localhost:7301',
    changeOrigin: true,
    secure: false,
    rewrite: (path) => path.replace(/^\/sample\/api/, '/api')
  }
}
```

### Authentication

The app uses Keycloak for authentication via the `@arribatec-sds/keycloak-auth-react` package.

**Configuration** (in `App.tsx`):
- Keycloak URL: `https://keycloak.localtest.me`
- Realms: `admin` and `demo`
- Silent SSO check enabled

## Building

### For Docker

The Dockerfile in the parent directory handles the build:

```bash
cd ..
docker-compose build
```

### For Production

```bash
npm run build
```

The build output will be in the `dist/` directory with:
- Base path: `/sample/`
- Source maps enabled
- Vendor chunk splitting for better caching

## Troubleshooting

### Certificate Issues

**Problem**: Browser shows "Not Secure" or certificate error

**Solutions**:
1. Run `npm run setup:certs` to generate certificates
2. Make sure mkcert is installed: `mkcert -version`
3. Install the local CA: `mkcert -install` (requires admin/sudo)
4. Check certificates exist: `ls .certs/`
5. Restart the development server after generating certificates

### Development Server Won't Start

**Problem**: Port 7300 already in use

**Solutions**:
1. Check what's using the port: `netstat -ano | findstr :7300` (Windows) or `lsof -i :7300` (Mac/Linux)
2. Kill the process or change the port in `vite.config.ts`

### API Calls Fail (CORS)

**Problem**: API requests fail with CORS errors

**Solutions**:
1. Make sure the backend is running on port 7301
2. Check the proxy configuration in `vite.config.ts`
3. Verify the backend has CORS enabled for `https://admin.localtest.me:7300`

### Hot Module Reload Not Working

**Problem**: Changes don't reflect in the browser

**Solutions**:
1. Check the browser console for errors
2. Try hard refresh: `Ctrl+Shift+R` (Windows/Linux) or `Cmd+Shift+R` (Mac)
3. Restart the development server
4. Clear the browser cache

## Related Documentation

- [Sample App README](../README.md) - Full sample application documentation
- [Multi-Tenant Development Guide](../../docs/MULTI_TENANT_APP_DEVELOPMENT_GUIDE.md) - Complete development guide
- [Prerequisites](../../docs/PREREQUISITES.md) - Required tools and setup
